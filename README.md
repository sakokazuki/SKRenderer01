
# GAME

## intro

ゲーム業界への転職を考えて、ゲームをつくってみることにした。
windowsで自由に開発ができる環境が今ないのでひとまずmacをつかってXCodeで開発をすすめる。

C++もopenFrameworksを少し触ったことがあるくらい、
Unityなしのゲームプログラミングは初めてだが2/2までに形にすることを目標にがんばる。

今日が12/6なので2ヶ月ないくらいか。

## 記録

このまま作品として提出したいし、自分の強みは自力で調べて
情報を集めながら身につけつつ、作っていけることかなと思い、
どの時期に何を考えていたか記録をつけることにした。

### 12/6

c++でゲームを作るときの標準構成？みたいなのを調べ、
GLFWでウインドウを出すところまで、やった。
GLFW3.2.1を使っていたが、実行時エラーがでて少しハマった。
3.3にバージョン上げればいいみたいな感じで書いてたのでそうした。

そのあとは、市場調査をした。
githubで適当な検索ワードでシンプルめなゲームのリポジトリを何個かみた。
次は、meshをつくって、それにshaderをあてるmeshの位置が動くところまでを目標にする。
※なんとなく、window部分だけclass分けたり、、みたいなリファクタリングをしたくなるだろうが我慢する。とりあえず書くことを目標に。



### 12/9

インターネットで情報を拾ってシェーダーを使って三角形をつくった。
ほとんどコピペしながら模写した。1ファイルにまとまっているので
ちょっとだけわけたい。移動とか回転ってどうするんだろ...

軽く調べ始めたら、今までの復習になりそう+もう少し踏み込んだ？ことが
超丁寧に書いてあるpdfを発見した。
http://marina.sys.wakayama-u.ac.jp/~tokoi/GLFW.pdf
ので移動中とかに読んでおく。
glewも使ったほうがいいのかな。手元にある本(https://www.borndigital.co.jp/book/2020.html)
もつかってるし。

### 12/13

シェーダーのコンパイルまわりがなんとなく落ち着きそうな雰囲気を
見せてきた。が、今日は時間が限界
3日に1回数時間しか作業できてなくて焦るーー


### 12/12

シェーダーのコンパイルらへんでつまる。
どうやら色んな方法があるみたい、とファイルをわけるのもなかなかうまくいかない

### 12/16

やっとシェーダーのファイルを分けてコンパイルして使うことができた。
Xcodeでfstreamでファイル読めないのに地味に手間取ったりした。
(edit schemeでプロジェクトパス指定してなかったから相対パスで読み込めてなかった)

でもいろんなコード比較しながらコードを読んだので詳細が理解できた、気がする。

ここまでつくってみて、VBOメッシュとシェーダーの関連付け?ってどうなってんだ
と思って調べたらどうやらgl_UserProgramとgl_UserProgram(0)の間に描画を挟むと
そのシェーダーが使われるようだ。
見ていたサンプルはmain()に一括で処理して終了もなかったので気になって調べてみた。

次は現状mainに全部書いてるやつを分けてmeshクラスを作成し移動や回転をさせるところを目指す。


### 12/19

前回に続き、meshをわけたり、移動、回転をやろうとしていろいろハマっていた。
まず、glpushmatirxとglpopmatrixとgltranslateてきなやつは全部非推奨になっているらしい。
それとどうやら自分で書いた  `glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, true);`は非推奨のものを
使えなくするやつらしい。。ということに気がつくまでにかなり時間を食ってしまった。
openGLが昔からあるのでしばしば古い資料があるので見分けがつかない、、本読めってことかな？
てことは、移動回転は全部positionをuniformで送ってvertex shaderで処理するのかなぁ。。

あとこれは解決していないのだけれど、glviewportでviewport設定すると
viewportがずれて最初出てくる。そしてウインドウを動かすと正常になる
そしてウインドウをリサイズするとまた狂う。
原因わかんないけど闇が深そうなのでとりあえずおいておこうかなと思う。

### 1/7

年末年始仕事のピークがやってきてこっちの勉強をする余裕がなかったという言い訳から2018年を始めます。
迷ったら見る行列関連の資料 http://www.opengl-tutorial.org/jp/beginners-tutorials/tutorial-3-matrices/
glmについてまとまってるやつ https://qiita.com/usagi/items/f34976a3d3011506ff7d
(後日記入)
この日までにplaneを回転させることができた。フレームワークとかゲームエンジンを使う時に
たまに出てくるワードprojectionMatrixとかviewMatrixとかの意味が少しわかった気がする。
threejsでカメラクラスのコンストラクタの引数にperspectiveとか持つけどその中身でこんなことが
おきてそうだなーっていう気づきがあったりして楽しい。
インターネットの記事を漁った感じ今のところ体系的にまとまっているのが
http://marina.sys.wakayama-u.ac.jp/~tokoi/GLFWdraft.pdf
なのでこちらを軸に進める方針にした。丁寧にまとまっており非常にわかりやすい。
現在進行形で続きが書き足されていっているっぽい(現時点で260ページ)
現状のコードはこの資料のコード+シェーダーコンパイル周りは確か別のやつ参考に、+行列計算まわりはglmで手抜き
という感じになっている。

### 1/10

ひとまずhttp://marina.sys.wakayama-u.ac.jp/~tokoi/GLFWdraft.pdf
の第8章形状の表現にあたるところまで進んだ。
頂点インデックスの順番がなんちゃらとかそういうのは何回かやったことあるので
すらすらこなした。attributeのlocationの設定をシェーダーのlink前にやってた部分は
openglのバージョンを上げればshaderのlayoutで設定できるらしいのでそっちですることにした。
現状で最後の章、第9章の陰影付けはメインの軸をこっちの本(https://www.borndigital.co.jp/book/2020.html)に
移したいと思う。なぜなら半年くらい前にopenFrameworks+glslの構成でこの本を途中まで読んでいるから。
ついに3D感がでてきて楽しくなってきた。
C++がわからないというフェーズにも差し掛かってきた気がする。

chrome閉じちゃうのでブクマ(http://miffysora.wikidot.com/opengl-deprecated)




### 1/11

`glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, ~~);`でGL_ELEMENT_ARRAY_BUFFERをbindして
別のクラスでもbindするとそっちが上書きされるっぽい挙動に引っかった。
そもそもrender時にbind/unbindして使うものなんだろうか、
それより先にトーラスクラス作ったけどそれもうまく表示できないから
トーラスを表示させてから複数オブジェクトの表示にチャレンジしたいと思う。
トーラスをphongシェーディング？するところまでできた。当たり前だけど急に3Dぽくなって
テンション上がった。glBindBufferらへんをこれから調査していく。


### 1/12
機能のglBindBufferの件は
今まで書いていたコードはglBIndVertexArrayしてから、なにもしてなかった。
glBindVertexArray(0)で終了？を明示的にしないといけないらしく、
そうしないがために違うオブジェクトでVAOつくる時に影響がでていたっぽいという
ところで解決しましたー　

### 1/15
こないだ何故かトーラスを回転させると
キューブのライティングが変になるという現象があり、それの解明に引っかかっていたのだけれど
normalのuniformを送り忘れていてtorusのものが使用されちゃってたからみたいな凡ミスだった。。つらい。


### 1/16
次はテクスチャとノーマルマップと思い、昨日の続きから。
昨日はテクスチャのロードにgliを使って1枚だけロードするところまでやっていた。
かんたんに導入できそうな画像読み込みのライブラリがgliだったのでddsをフォトショップで
編集にできるようにしたり、みたいなので時間もかかった。
あとはテクスチャを複数枚使うときの設定？TEXTURE0みたいなのも少し、、

そのあとnormalマップ貼ろうとしたら、どうやら接ベクトルというものが必要らしいと。
接ベクトルとは何か、計算方法(texcoordとか使うやつ)を調べて実装するところまでおわた。
(これでできているかは謎)
不安なので、本についてるモデルで試そうと思う＝objをロードするvboメッシュが必要になるので
明日はその辺から進めようと思う







